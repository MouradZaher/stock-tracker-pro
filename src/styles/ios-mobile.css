/* =========================================================
   iOS MOBILE RESPONSIVE FIXES
   iPhone 13 Pro (390×844 CSS px) — Chrome Browser
   Usable viewport: 390×704px (Chrome toolbar ~72px top + ~68px bottom)
   Safe-area-top: 47px (notch), Safe-area-bottom: 34px (home bar)
   ========================================================= */

/* iOS Safe Area Env Variables */
:root {
    --safe-area-top: env(safe-area-inset-top, 0px);
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-left: env(safe-area-inset-left, 0px);
    --safe-area-right: env(safe-area-inset-right, 0px);

    /* Mobile header reduced to 38px for iPhone 13 Pro compactness */
    --mobile-header-height: 38px;
    --mobile-nav-height: 68px;
}

/* =========================================================
   BASE MOBILE LAYOUT  (≤ 768px)
   ========================================================= */
@media (max-width: 768px) {

    /* --- Viewport Scroll enabled --- */
    html,
    body {
        height: 100%;
        min-height: 100%;
        width: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        position: relative;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: auto;
    }

    #root {
        height: 100%;
        overflow: visible;
    }

    .app {
        height: 100%;
        width: 100%;
        display: flex;
        flex-direction: column;
        overflow: visible;
    }

    /* ---------------------------------------------------------
       HEADER — iPhone 13 Pro optimised (38px, smaller icons)
       LOCKED: Approved 2026-02-25
       --------------------------------------------------------- */
    .header {
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        align-items: center !important;
        justify-content: space-between !important;

        /* 38px content + safe-area-top for notch */
        height: calc(var(--mobile-header-height) + var(--safe-area-top)) !important;
        min-height: calc(var(--mobile-header-height) + var(--safe-area-top)) !important;
        max-height: calc(var(--mobile-header-height) + var(--safe-area-top)) !important;

        padding: 0 8px !important;
        padding-top: var(--safe-area-top) !important;
        gap: 4px;
        overflow: visible;

        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1002;
    }

    /* Logo: tighter, smaller text */
    .header-logo {
        flex-shrink: 0;
        margin-bottom: 0;
    }

    .logo-text {
        font-size: 0.75rem !important;
        letter-spacing: -0.01em;
    }

    /* All action icon buttons: 22px tall, 11px icons, 3px gap */
    .header-actions {
        flex-shrink: 0;
        flex-wrap: nowrap;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .header-actions button {
        height: 22px !important;
        min-width: 22px;
        padding: 2px 4px !important;
        font-size: 0.6rem !important;
        border-radius: 8px !important;
        line-height: 1;
    }

    /* Force icon sizing inside action buttons */
    .header-actions button svg {
        width: 11px !important;
        height: 11px !important;
    }

    /* Flag image (market selector) */
    .header-actions button img {
        width: 13px !important;
        height: 9px !important;
    }

    /* Hide all text-labels inside header on mobile */
    .header-actions .desktop-only,
    .header-center {
        display: none !important;
    }

    /* ---------------------------------------------------------
       MAIN CONTENT AREA
       --------------------------------------------------------- */
    .main-content {
        flex: 1;
        padding-top: calc(var(--mobile-header-height) + var(--safe-area-top));
        padding-bottom: var(--mobile-nav-height);
        overflow: visible;
        position: relative;
        min-height: 0;
    }

    /* ---------------------------------------------------------
       TAB CONTENT — scrollable region
       --------------------------------------------------------- */
    .tab-content {
        height: 100%;
        width: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior-y: contain;
        padding-bottom: calc(var(--mobile-nav-height) + 16px + var(--safe-area-bottom));
        scroll-behavior: smooth;
    }

    /* Home tab pan gesture support */
    .home-tab-content {
        touch-action: pan-y pinch-zoom;
    }

    /* ---------------------------------------------------------
       MOBILE BOTTOM NAV
       --------------------------------------------------------- */
    .mobile-nav-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        padding-bottom: var(--safe-area-bottom);
        z-index: 1001;
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-top: 1px solid var(--glass-border);
    }

    .mobile-nav-pill {
        width: 100%;
        border-radius: 0;
        padding: 6px 0;
        justify-content: space-around;
        background: transparent;
        border: none;
        box-shadow: none;
    }

    /* Mobile nav buttons: even spacing across 390px */
    .mobile-nav-btn {
        flex: 1;
        min-width: 0;
        padding: 6px 2px;
        font-size: 0.6rem;
    }

    .mobile-nav-btn svg {
        width: 18px;
        height: 18px;
    }

    /* ---------------------------------------------------------
       CARDS & CONTENT
       --------------------------------------------------------- */
    .glass-card {
        word-break: break-word;
        overflow-wrap: break-word;
    }

    /* Prevent iOS input zoom (must be 16px+) */
    input,
    select,
    textarea {
        font-size: 16px;
    }

    /* Remove tap highlight */
    button,
    a,
    .mobile-nav-btn {
        -webkit-tap-highlight-color: transparent;
    }

    /* Admin modal — full screen on mobile */
    .admin-modal {
        width: 100%;
        margin: 0;
        border-radius: 0;
        height: 100%;
        max-height: 100%;
    }

    /* Portfolio table — horizontal scroll container */
    .portfolio-table-wrapper {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* AI signal cards grid: single column on 390px */
    .ai-signal-card {
        min-width: 0;
    }

    /* Hide keyboard-visible bottom nav */
    .keyboard-open .mobile-nav-container {
        display: none;
    }

    .keyboard-open .main-content {
        padding-bottom: 0;
    }
}

/* =========================================================
   HEATMAP FIXED OVERLAY  (≤ 768px)
   LOCKED: Exact alignment with 38px mobile header 2026-02-25
   ========================================================= */
@media (max-width: 768px) {
    .heatmap-wrapper {
        position: relative;
        height: calc(100dvh - var(--mobile-header-height) - var(--mobile-nav-height) - var(--safe-area-top) - var(--safe-area-bottom) - 10px);
        width: 100%;
        overflow: hidden;
        background: var(--color-bg-primary);
        display: block;
        border-radius: 8px;
    }

    .heatmap-container,
    .tradingview-widget-container,
    .tradingview-widget-container iframe {
        height: 100%;
        width: 100%;
        border: none;
    }

    /* Hide surrounding text while heatmap is full-screen */
    .home-tab-content h2,
    .home-tab-content p {
        display: none;
    }
}

/* =========================================================
   iPhone SE / Mini  (≤ 375px) — extra-compact overrides
   ========================================================= */
@media (max-width: 375px) {
    :root {
        --mobile-header-height: 36px;
        --spacing-xl: 0.8rem;
        --spacing-lg: 0.6rem;
        --spacing-md: 0.4rem;
        --font-size-lg: 0.88rem;
        --font-size-base: 0.82rem;
        --font-size-sm: 0.72rem;
        --font-size-xs: 0.62rem;
    }

    .logo-text {
        font-size: 0.7rem !important;
    }

    .header-actions button {
        height: 20px !important;
        padding: 2px 3px !important;
        font-size: 0.55rem !important;
    }

    .header-actions button svg {
        width: 10px !important;
        height: 10px !important;
    }

    .glass-card {
        padding: 0.6rem;
    }

    .btn {
        padding: 0.35rem 0.6rem;
        font-size: 0.7rem;
    }

    .header-actions {
        gap: 3px;
    }
}
/* =========================================
   iOS MOBILE RESPONSIVE FIXES
   iPhone 13 Pro (390x844) Optimized
   ========================================= */

/* iOS Safe Area Support */
:root {
    --safe-area-top: env(safe-area-inset-top, 0px);
    --safe-area-bottom: env(safe-area-inset-bottom, 0px);
    --safe-area-left: env(safe-area-inset-left, 0px);
    --safe-area-right: env(safe-area-inset-right, 0px);
    --mobile-nav-height: 80px;
}

/* =========================================
   MOBILE LAYOUT (max-width: 768px)
   ========================================= */
@media (max-width: 768px) {

    /* Root scrolling control - PREVENT ROOT SCROLLING */
    html,
    body {
        height: 100% !important;
        min-height: 100% !important;
        overflow-x: hidden !important;
        overflow-y: hidden !important;
        position: relative !important;
        width: 100% !important;
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior-y: none;
    }

    #root {
        height: 100% !important;
        overflow: hidden !important;
    }

    .app {
        height: 100% !important;
        width: 100%;
        display: flex;
        flex-direction: column;
        overflow: hidden !important;
    }

    /* Mobile Header — force single row, fixed height */
    .header {
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        align-items: center !important;
        justify-content: space-between !important;
        height: calc(56px + var(--safe-area-top)) !important;
        min-height: calc(56px + var(--safe-area-top)) !important;
        max-height: calc(56px + var(--safe-area-top)) !important;
        padding-top: calc(0.4rem + var(--safe-area-top)) !important;
        padding-bottom: 0.4rem !important;
        padding-left: 0.75rem !important;
        padding-right: 0.75rem !important;
        gap: 0.4rem !important;
        overflow: visible !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1002 !important;
    }

    /* Logo — prevent shrinking */
    .header-logo {
        flex-shrink: 0 !important;
        margin-bottom: 0 !important;
    }

    /* Logo text — slightly smaller on mobile */
    .logo-text {
        font-size: 0.9rem !important;
    }

    /* Header actions — keep icons right-aligned, no wrap */
    .header-actions {
        flex-shrink: 0 !important;
        flex-wrap: nowrap !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.3rem !important;
    }

    /* Icon buttons — slightly smaller on mobile */
    .header-actions .glass-button.icon-btn {
        width: 30px !important;
        height: 30px !important;
    }

    /* Hide logout text on mobile — keep only the icon */
    .logout-btn .desktop-only {
        display: none !important;
    }

    /* Main content area */
    .main-content {
        flex: 1;
        padding-top: calc(56px + var(--safe-area-top));
        padding-bottom: var(--mobile-nav-height);
        overflow: hidden;
        position: relative;
    }

    /* Unified Tab content scrolling */
    .tab-content {
        height: 100%;
        width: 100%;
        overflow-y: auto !important;
        overflow-x: hidden !important;
        -webkit-overflow-scrolling: touch !important;
        overscroll-behavior-y: contain !important;
        padding-bottom: calc(var(--mobile-nav-height) + 20px + var(--safe-area-bottom));
        scroll-behavior: smooth;
    }

    /* Home/Search tab - Dynamic overflow handled in App.tsx */
    .home-tab-content {
        touch-action: pan-y pinch-zoom;
    }

    /* Mobile Nav */
    .mobile-nav-container {
        position: fixed;
        bottom: 0 !important;
        left: 0;
        right: 0;
        width: 100%;
        padding-bottom: var(--safe-area-bottom);
        z-index: 1001;
        background: var(--glass-bg);
        backdrop-filter: var(--glass-blur);
        -webkit-backdrop-filter: var(--glass-blur);
        border-top: 1px solid var(--glass-border);
    }

    .mobile-nav-pill {
        width: 100%;
        border-radius: 0;
        padding: 8px 0;
        justify-content: space-around;
        background: transparent;
        border: none;
        box-shadow: none;
    }

    /* Sizing for smaller phones (iPhone SE/Mini) */
    @media (max-width: 375px) {
        :root {
            --spacing-xl: 1rem;
            --spacing-lg: 0.75rem;
            --spacing-md: 0.5rem;
        }

        .logo-text {
            font-size: 0.9rem;
        }

        .header-tab {
            padding: 0.3rem 0.5rem;
            font-size: 0.7rem;
        }

        .glass-card {
            padding: 0.75rem !important;
        }

        .btn {
            padding: 0.5rem 0.75rem !important;
            font-size: 0.75rem !important;
        }
    }

    /* Prevent text overflow in cards */
    .glass-card {
        word-break: break-word;
        overflow-wrap: break-word;
    }

    .admin-modal {
        width: 100% !important;
        margin: 0 !important;
        border-radius: 0 !important;
        height: 100% !important;
        max-height: 100% !important;
    }
}

/* =========================================
   HEATMAP LOCKING (FIXED OVERLAY)
   ========================================= */
@media (max-width: 768px) {
    .heatmap-wrapper {
        position: fixed !important;
        top: calc(60px + var(--safe-area-top)) !important;
        bottom: var(--mobile-nav-height) !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 1 !important;
        overflow: hidden !important;
        background: var(--color-bg-primary);
    }

    .heatmap-container,
    .tradingview-widget-container,
    .tradingview-widget-container iframe {
        height: 100% !important;
        width: 100% !important;
        border: none !important;
    }

    /* Hide text when heatmap is active */
    .home-tab-content h2,
    .home-tab-content p {
        display: none !important;
    }
}

/* =========================================
   FORM & INTERACTION FIXES
   ========================================= */
@media (max-width: 768px) {

    input,
    select,
    textarea {
        font-size: 16px !important;
    }

    button,
    a,
    .mobile-nav-btn {
        -webkit-tap-highlight-color: transparent;
    }

    .keyboard-open .mobile-nav-container {
        display: none;
    }

    .keyboard-open .main-content {
        padding-bottom: 0;
    }
}